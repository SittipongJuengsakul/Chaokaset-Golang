{{set . "title" "บัญชีการเพาะปลูก"}}
{{template "Templates/header.html" .}}
{{template "Templates/preloader.html" .}}
<script type="text/javascript">
  $('#myModal').on('shown.bs.modal', function () {
  $('#myInput').focus()
})

$('#EditAccount').on('shown.bs.modal', function () {
$('#myInput').focus()
})
</script>
<!-- Modal -->
<div ng-app="ChaokasetApp" ng-controller="AddAccount">
 <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h2 class="color-green">เพิ่มบัญชีการเพาะปลูก</h2>
      </div>
      <div class="modal-body">
        <div class="row">
        <div class="col-sm-12 container-box">
          <div class="col-sm-12 container-box-content" >
            <form ng-submit="AccountSubmit()" >
              <div class="info-plant-show">
                <div class="form-grop col-md-12" style="padding: 0px;">
                  {{with $field := field "Account.TypeAccount" .}}
                  <div class="form-group col-md-12 padding-left-no padding-right-no">
                    <label>ประเภทบัญชี</label>
                    <select class="form-control" name="{{$field.Name}}" ng-model="TypeAccount" id="SelTypeAccount">
                       <option ng-repeat="typeaccount in TypeAccounts" ng-bind="typeaccount.Text" ng-value="typeaccount.Type"></option>
                    </select>
                  </div>
                  {{end}}
                </div>
                <div class="form-grop col-md-12" style="padding: 0px;">
                  {{with $field := field "Account.Details" .}}
                  <div class="form-group col-md-12 padding-left-no padding-right-no">
                    <label>รายละเอียด</label>
                    <input type="text" class="form-control" placeholder="กรอกรายละเอียด" name="{{$field.Name}}" value="{{$field.Flash}}" ng-model="Details" required>
                    <span class="error">{{$field.Error}}</span>
                  </div>
                  {{end}}
                </div>
                <div class="form-grop col-md-12" style="padding: 0px;">
                  {{with $field := field "Account.Price" .}}
                  <div class="form-group col-md-12 padding-left-no padding-right-no">
                    <label>จำนวนเงิน</label>
                    <input type="number" class="form-control" placeholder="กรอกจำนวนเงิน" name="{{$field.Name}}" value="{{$field.Flash}}" ng-model="Price" required>
                    <span class="error">{{$field.Error}}</span>
                  </div>
                  {{end}}
                </div>
              </div>
          </div>
        </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">บันทึก</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">ปิด</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="EditAccount" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
 <div class="modal-dialog" role="document">
   <div class="modal-content">
     <div class="modal-header">
       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
       <h2 class="color-green">แก้ไขบัญชีการเพาะปลูก</h2>
     </div>
     <div class="modal-body">
       <div class="row">
       <div class="col-sm-12 container-box">
         <div class="col-sm-12 container-box-content" >
           <form ng-submit="EditAccountSubmit()" >
             <input type="hidden" name="name" ng-model="EditAccountId">
             <div class="info-plant-show">
               <div class="form-grop col-md-12" style="padding: 0px;">
                 {{with $field := field "Account.EditDetails" .}}
                 <div class="form-group col-md-12 padding-left-no padding-right-no">
                   <label>รายละเอียด</label>
                   <input type="text" class="form-control" placeholder="กรอกรายละเอียด" name="{{$field.Name}}" value="{{$field.Flash}}" ng-model="EditDetails" required>
                   <span class="error">{{$field.Error}}</span>
                 </div>
                 {{end}}
               </div>
               <div class="form-grop col-md-12" style="padding: 0px;">
                 {{with $field := field "Account.EditPrice" .}}
                 <div class="form-group col-md-12 padding-left-no padding-right-no">
                   <label>จำนวนเงิน</label>
                   <input type="number" class="form-control" placeholder="กรอกจำนวนเงิน" name="{{$field.Name}}" value="{{$field.Flash}}" ng-model="EditPrice" required>
                   <span class="error">{{$field.Error}}</span>
                 </div>
                 {{end}}
               </div>
             </div>
         </div>
       </div>
       </div>
     </div>
     <div class="modal-footer">
       <button type="submit" class="btn btn-success">บันทึก</button>
       <button type="button" class="btn btn-danger" data-dismiss="modal">ปิด</button>
       </form>
     </div>
   </div>
 </div>
</div>
<div class="chaokaset-container-verticle" id="chaokaset-loader" style="display: none;">
  {{template "Crops/headerCrop.html" .}}
  {{template "Crops/sidebarcrops.html" .}}
  <div class="col-sm-9 container-box">
    <div class="col-sm-12 container-box-content" >
      <div class="col-sm-5 name-header padding-left-no padding-right-no"><h2 class="color-green">บัญชีการเพาะปลูก</h2></div>
      <div class="col-sm-7 name-header padding-left-no padding-right-no">
        <div class="col-sm-4">
          <button type="button" name="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">เพิ่มข้อมูล</button>
        </div>
        <div class="col-sm-8" style="padding: 0px;">
          <input type="text" name="SearchCrops" class="form-control" placeholder="ค้นหารายการบัญชี" ng-model="searchText">
        </div>
      </div>
      <table class="table col-md-12">
        <thead class="box-thead-show">
          <tr>
            <th width="20%">วันที่</th>
            <th width="35%">ชื่อรายการ</th>
            <th>ประเภท</th>
            <th>จำนวนเงิน (บาท)</th>
            <!--<th>ยอดเงินรวม</th>-->
            <th>ตัวเลือก</th>
          </tr>
        </thead>
        <tbody class="box-tbody-show">
          <tr ng-if="accountdatas" ng-repeat="acdata in accountdatas | filter:searchText">
            <td ng-bind="acdata.Updated_at | date:'dd MMM yyyy': '+700'"></td>
            <td ng-bind="acdata.Detail"></td>
            <td ng-if="acdata.TypeAccount == 1">รายรับ</td>
            <td ng-if="acdata.TypeAccount == 2">รายจ่าย</td>
            <td ng-if="acdata.TypeAccount == 1" class="color-green" ng-bind="acdata.Price | number"></td>
            <td ng-if="acdata.TypeAccount == 2" class="color-red" ng-bind="acdata.Price | number"></td>
            <!--<td ng-bind="totalaccount(acdata.Price)"></td>-->
            <td class="color-green">
              <div class="dropdown">
                <a href="#" class="dropdown-toggle option-crops"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">ดูเพิ่มเติม <span class="caret"></span></a>
                </button>
                <ul class="dropdown-menu dd-menu" aria-labelledby="dropdownMenu1">
                  <li><a ng-click="EditAccountModal(acdata.AccountId)">แก้ไขรายการ</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a ng-click="RemoveAccount(acdata.AccountId)" class="color-red">ลบรายการ</a></li>
                </ul>
              </div>
            </td>
          </tr>
          <tr ng-if="!accountdatas" style="text-align: center;">
              <td colspan="5">
                ไม่มีข้อมูล
              </td>
          </tr>
        </tbody>
      </table>
      <nav>
        <!-- แสดง 10 รายการ -->
        <ul class="pager">
          <li id="IdPrevPage" class="pager-prev"><a ng-click="PrevPages()">< ย้อนกลับ</a></li>
          <li id="IdNextPage" class="pager-next"><a ng-click="NextPages()">ต่อไป ></a></li>
        </ul>
      </nav>
    </div>
  </div>
</div>
</div>
<script type="text/javascript">
  var skipper = 0;
  function PravNext(accountlength){
    if(skipper == 0){
      $("#IdPrevPage").addClass("disabled");
    }else{
      $("#IdPrevPage").removeClass("disabled");
    }
    if(accountlength < 10){
      $("#IdNextPage").addClass("disabled");
    }else{
      $("#IdNextPage").removeClass("disabled");
    }
  }
  var app = angular.module('ChaokasetApp', ['ngSanitize']);
  app.controller('AddAccount', function($scope, $http) {
    var idcrop = {{.cropdata.CropId}};
      $http.get(site_url+"/apiv1_0/accounts/"+idcrop+"/"+skipper)
      .then(function(response) {
        //console.log(response.data.AccountDatas.length);
        $scope.accountdatas = response.data.AccountDatas;
        PravNext($scope.accountdatas.length);
      });
      $scope.TypeAccounts = [{Text: "รายรับ",Type: 1},{Text: "รายจ่าย",Type: 2}];
        $scope.url = site_url+"/apiv1_0/saveaccount/";
        $scope.AccountSubmit = function() {//บันทึกบัญชี
          var idtype = document.getElementById('SelTypeAccount').value;
          $http({
            method: 'POST',
            url: $scope.url+idcrop+"/"+idtype+"/"+$scope.Details+"/"+$scope.Price
          }).then(function(response) {
            //สำเร็จ
            $scope.accountdatas = response.data.AccountDatas;
            PravNext($scope.accountdatas.length);
            $scope.Details = "";
            $scope.Price = "";
          },function(response) {
            //ผิดพลาด
        });
        $('#myModal').modal('hide');
        }
      $scope.EditAccountModal = function(idaccount) { //โชแก้ไข
        $http.get(site_url+"/apiv1_0/getoneaccount/"+idcrop+"/"+idaccount)
        .then(function(response) {
          console.log(response.data);
          //$scope.accountdatas = ;
          $scope.EditAccountId = idaccount;
          $scope.EditDetails = response.data.AccountData.Detail;
          $scope.EditPrice = response.data.AccountData.Price;
          $('#EditAccount').modal('show');
        });
      }
      $scope.EditAccountSubmit = function() {//บันทึกแก้ไข
        var idtype = document.getElementById('SelTypeAccount').value;
        $http({
          method: 'POST',
          url: site_url+"/apiv1_0/editaccount/"+$scope.EditAccountId+"/"+$scope.EditDetails+"/"+$scope.EditPrice
        }).then(function(response) {
          //สำเร็จ
          $http.get(site_url+"/apiv1_0/accounts/"+idcrop+"/0")
          .then(function(response) {
            $scope.accountdatas = response.data.AccountDatas;
            PravNext($scope.accountdatas.length);
          });
          $('#EditAccount').modal('hide');
          $scope.EditAccountId = "";
          $scope.EditDetails ="";
          $scope.EditPrice = "";
        },function(response) {
          //ผิดพลาด
      });
      }
      $scope.RemoveAccount = function(idaccount) {//ลบบัญชี
        $http({
          method: 'POST',
          url: site_url+"/apiv1_0/removeaccount/"+idaccount
        }).then(function(response) {
          //สำเร็จ
          $http.get(site_url+"/apiv1_0/accounts/"+idcrop+"/0")
          .then(function(response) {
            $scope.accountdatas = response.data.AccountDatas;
            PravNext($scope.accountdatas.length);
          });
        },function(response) {
          //ผิดพลาด
      });
      }
      $scope.PrevPages = function() {
        if($("#IdPrevPage").hasClass("disabled") != true){
          if(skipper<=0){
            skipper = 0;
          }else{
            skipper = skipper-1;
          }
          $http.get(site_url+"/apiv1_0/accounts/"+idcrop+"/"+skipper)
          .then(function(response) {
            $scope.accountdatas = response.data.AccountDatas;
            PravNext($scope.accountdatas.length);
          });
        }
      }
      $scope.NextPages = function() {
        if($("#IdNextPage").hasClass("disabled") != true){
          skipper = skipper+1;
          $http.get(site_url+"/apiv1_0/accounts/"+idcrop+"/"+skipper)
          .then(function(response) {
            $scope.accountdatas = response.data.AccountDatas;
            PravNext($scope.accountdatas.length);
          });
        }
      }
  });
</script>
{{template "Templates/footer.html" .}}
